---
title: "pa5: Profiency as a Function of Age, Motivation, and IQ"
author: "Isabelle Chang"
date: "2023-04-12"
output: word_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load libraries
```{r, 'load_libraries', echo=TRUE}
library("papaja")
library("tidyverse")
library("here")
library("ds4ling")
library("lmtest")
```


# Load data
```{r, 'load_data', echo=TRUE}
raw_data <- read_csv(file=here('data_raw', 'pa_5_data', 'lang_data_raw.csv'))
head(raw_data, 6)
```

# Tidy data and add composite score
```{r, 'tidy_data', echo=TRUE}
tidy_data <- raw_data %>%
  separate(col = id,
           into = c("id", "sex", "age"),
           sep = "_") %>%
  mutate(
    sex = as.factor(sex),
    age = as.factor(age),
    composite_score = log(iq / 80) + log(motivation)) %>%
  arrange(age,sex)

tidy_data

write_csv(tidy_data, file=here('data_clean','lang_data_clean.csv'))
```

# Descriptive statistics
```{r, 'des_stats', echo=TRUE}
summary(tidy_data)
tidy_data_df <- read.csv(file=here('data_clean', 'lang_data_clean.csv'))

tidy_data_df %>%
  mutate(
    #turn group and age into factors
    sex = as.factor(sex),
    age = as.factor(age)) %>%
  group_by(age,sex) %>%
  summarize(
    avg_mot=mean(motivation),
    sd_mot=sd(motivation),
    avg_comp=mean(composite_score),
    sd_comp=sd(composite_score),
    avg_prof=mean(prof),
    sd_prof=sd(prof)
  ) %>%
  mutate_if(is.numeric, round, digits=3) %>%
  knitr::kable()
```

### Statistical observations:
* Within the same biological sex, is no difference in motivation between older and younger age groups.
* The composite score contains part of an individual's iq and motivation scores. Within the same biological sex, there is no difference in these scores across age groups which suggests that there is no difference in iq scores across age groups, either.
* Average motivation and composite scores are very similar across biological sex.
* On average, the younger age group has a higher proficiency score than the older age group. Within age groups, females have a marginally higher average proficiency score than males do.

# Plot of proficiency as a function of composite score

```{r, 'plot_data'}
plot_prof_composite <-tidy_data %>%
  ggplot() +
  aes(x=composite_score, y=prof, color=sex) +
  facet_grid(.~age) +
  geom_point(alpha=0.3) +
  geom_smooth()

#save as higher res image
ggsave(here("figs", "plot_prof_composite.png"),
       plot = plot_prof_composite,
)

#display saved image
knitr::include_graphics(here("figs","plot_prof_composite.png"))
```

### Plot observations

This plot displays proficiency as a function of composite score. Based on the descriptive statistics, I hypothesized that proficiency would vary depending on composite score--namely, that a higher composite score would result in a higher proficiency score. The plot confirms that these two variables are positively correlated.

This plot also shows that younger participants, on average, have a higher proficiency score than older participants, suggesting that age may have an effect on proficiency score.

Variability in proficiency is greater in females than males for the "older" age group, and the opposite is true for the "younger" age group. Overall, variability in proficiency is about the same for males and females.

# Model testing
```{r, 'model-testing'}
# question: does proficiency vary as a function of age and comp score?
#base model
mod_0 <- lm(prof ~ 1, data = tidy_data)

# test main effect of age
mod_age <- lm(prof ~ age, data = tidy_data)

# test main effect of comp score
mod_comp <- lm(prof ~ composite_score, data = tidy_data)

# test main effects; additive model gives us main effects of age and comp score together
mod_add <- lm(prof ~ composite_score + age, data = tidy_data)
#summary(mod_add)

# test interaction between age and comp
mod_mult <- lm(prof ~ composite_score + age + composite_score:age, data = tidy_data)
#summary(mod_mult)

# compare 
anova(mod_0, mod_comp, mod_add, mod_mult)

# model with interaction is better than main effect model
```

# Best model and assumptions testing
As seen in our nested model comparison above, a model containing the two-way interaction between age and composite score is a better fit than one without it. The summary for it is as follows:

```{r, 'best_mod_summary'}
summary(mod_mult)
```

Given this model, we test the following assumptions:

### 1. Linear relationship between $x_i$ and $y_i$
```{r, 'assumptions_lin'}
best_model_plot <- tidy_data %>%
  ggplot() +
  aes(x=composite_score, y=prof, color=age, se=TRUE) +
  geom_point() +
  geom_smooth(method=lm)

#save as higher res image
ggsave(here("figs", "best_model.png"),
       plot = best_model_plot,
)

#display saved image
knitr::include_graphics(here("figs","best_model.png"))
```

A visual inspection of the scatter plot suggests that there is a linear relationship between composite score and proficiency.

### 2. Mean of residuals = 0

```{r, 'assumptions_mean'}
# problem: summary() function not displaying mean of residuals; only median
# solution: get residuals and find the mean manually
resid <- residuals(mod_mult)
mean(resid)
```

The mean of residuals for this model is `r mean(residuals(mod_mult))`, which when rounded equals 0.

### 3. Homoscedasticity of residuals
```{r, 'assumptions_homoscedasticity'}
diagnosis(mod_mult)
```

When residuals are plotted as a function fitted values, there is no visible pattern in the points, suggesting homoscedasticity of residuals.

### 4. No autocorrelation of residuals
```{r, 'assumptions_auto'}
acf(resid)
#knitr::include_graphics(here("figs","auto_plot.png"))
# helpful page for explaining durbin-watson test: https://www.reneshbedre.com/blog/durbin-watson-test.html

dwtest(formula = mod_mult)
```

Upon visual inspection, is no significant correlation of residuals besides the first residual value. The Durbin-Watson test also returns a test statistic of 2.0145 suggesting that there is no autocorrelation. Additonally, the calculated p-value of 0.518 leads us to reject the null hypothesis stating that residuals are not autocorrelated.

### 5. Predictors not correlated with residuals
Most of the time, correlation between predictors and residuals occurs when a relevant variable is omitted. Of the variables we are given, the only one not included in this model is biological sex. The descriptive statistics show that biological sex has at best a small effect on composite score and proficiency. Omitting this variable would not have a significant impact on the model's performance, and the model's predictors are thus not correlated with its residuals.

### 6. Normality of residuals
Looking at the histogram of residual density above, the residual values look to be normally distributed (perhaps slightly skewed towards the left). The Q-Q plot suggests the same conclusion, as most of the points fall where the normal curve predicts them to.

# Results
Write up the results. You should include (1) a description of the statistical analyses you have done in one paragraph, and (2) the actual interpretation of the results in another (see class slides for examples). Donâ€™t forget to include an overall assessment of goodness of fit (variance explained).

## Model description

The proficiency data were analyzed using a general linear model. Proficiency test score was the criterion with composite score (of motivation and iq) and participant age group (younger/older) as predictors. Main effects of age and composite score and the age by composite score interaction were assessed using nested model comparisons. Experiment-wise alpha was set at 0.05.

## Interpretation and goodness of fit

There was a main effect of composite score (F(1) = 84.68, p < 0.001) and age group (F(1) = 67.05; p < 0.001), as well as a composite score by age group interaction (F(1) = 9.81; p < 0.002). The model containing the interaction provided the best fit of the data (R2 = 0.45). Although this model is better than the other models tested, it only results in 45% of variance in proficiency score values being explained by composite score and age group--the model fit could be improved, perhaps by another variable.

Overall, proficiency increased as a function of composite score. However, the size of the effect was modulated by learner age group. Specifically, older learners showed an increase in proficiency of approximately 0.91 units +/- 0.10 se per composite score unit (t = 8.722, p < 0.001). Younger learners showed an additional increase in proficiency of approximately 0.35 units per composite score unit (total = 1.26, t = 4.758, p < 0.001). However, the effect of composite score on proficiency is 0.46 units less +/- 0.15 se for younger learners than it is for older learners (t = -3.133, p < 0.003).

